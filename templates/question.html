
{% extends "layout.html" %}
{% block title %}{{ title }}{% endblock %}

{% block content %}

{% set question_id = question[0] %}

<script src="{{url_for('static', filename='script.js')}}"></script>

<div class="wrapper">
    
    <!-- Error messages in a loop with classes: error, success -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <p class="{{ category }}">{{ message }}</p>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <h1>{{ question[4] }}</h1>
    <h5>Question: {{ question_id }} | Views: {{ question[2] }} | Submission: {{ question[1] }}</h5>

    <form action="">
        <p class="actionbuttons">
            <a href="{{ url_for('show_edit_question_form', question_id=question_id) }}" class="cta">Edit question</a>
            <a href="{{ url_for('delete_question', question_id=question_id) }}" class="delete_button">Delete question</a>
            <a href="{{ url_for('show_new_answer_form', question_id=question_id) }}" class="cta">Add answer</a>
            <a href="{{ url_for('show_add_tag', question_id=question_id) }}" class="cta">Add tag</a>
            <a href="{{ url_for('show_question_list') }}" class="cta">Back to Questions</a>
        </p>
    </form>

    <table class="q_table">
        <tr>
            <td class="vote_cell">
                <div class="voter">
                    <a href="{{ url_for('vote', direction='up', question_id=question_id) }}" class="voteup"><img src="{{ url_for('static', filename='upvote.svg') }}"></a>
                    <div><span class="votecounter"> {{ question[3] }} </span></div>
                    <a href="{{ url_for('vote', direction='down', question_id=question_id) }}" class="votedown"><img src="{{ url_for('static', filename='downvote.svg') }}"></a>
                </div>
            </td>
            <td class="desc_cell">
                <p class="description">{{ question[5] }}</p>
                {% if added_tags %}
                <div class="tags">
                    {% for tag_id, tag_name in added_tags %}
                    <span>{{ tag_name }}<a href="{{ url_for('delete_tag', question_id=question_id, tag_id=tag_id) }}">×</a></span>
                    {% endfor %}
                </div>
                {% endif %}
            </td>
        </tr>
    </table>
    
    {% if question[6] %}
        <h3>Attachment</h3>
        <a href="{{ url_for('static',filename='uploads/' + question[6]) }}" target="_blank">
            <img src="{{ url_for('static',filename='uploads/' + question[6]) }}" alt="Question Image" class="attachment">
        </a>
    {% endif %}

    <h3>Comments</h3>
    {% if q_comments %}        
        {% for comment in q_comments %}
            <div>     
                <p class="commentzone">{{ comment[3] }}</p>
                <h5>Submission time: {{ comment[4] }} | Number of times edited: {{ comment[5] }}</h5>
                <h5><a href="{{ url_for('remove_comment', question_id=question_id, comment_id=comment[0]) }}" class="delete_mini">✖ Delete</a></h5>
                <form action="{{ url_for('fetch_comment_for_edit', question_id=question_id, comment_id=comment[0]) }}" method="POST" enctype='multipart/form-data'>
                    <label>Edit comment</label>
                    <input class="conditional_form_part_activator" type="checkbox" value="edit">
                    <div class="conditional_form_part" id="cd">
                        <textarea class="textarea" name="get_comment"></textarea><br>
                        <input type="submit" value="Submit comment" class="cta">
                    </div>
                </form>
            </div>
        {% endfor %}
    {% else %}
    <p>There are no comments yet! Be the first to comment!</p>
    {% endif %}

    <div class = "q_comments">
        <button onclick="hideMe()" class="cta marg">Add comment</button>
        <form action="{{ url_for('add_comment', question_id=question_id, answer_id=none) }}" method="POST" enctype='multipart/form-data'>
            <div id="q_comment">
                <textarea class="textarea" name="get_comment"></textarea><br>
                <input type="submit" value="Submit comment" class="cta marg">
            </div>
        </form>
    </div>

    {% if answers %}
        <hr>
        <h3>Answers</h3>
        {% for answer in answers %}
            <p class="answers">{{ answer[4] }}</p>
            <div class="voter-mini">
                <a href="{{ url_for('vote', direction='up', answer_id=answer[0]) }}" class="voteup-mini">▲</a>
                <a href="{{ url_for('vote', direction='down', answer_id=answer[0]) }}" class="votedown-mini">▼</a>
            </div>
            <h5><a href="{{ url_for('delete_answer', answer_id=answer[0]) }}" class="delete_mini">✖ Delete</a>Submission: {{ answer[1] }} | Votes: {{ answer[2] }}</h5>

            {% if answer[5] %}
                <img src="{{ url_for('static',filename='uploads/' + answer[5]) }}" alt="Answer Image">
            {% endif %}

            <form action="{{ url_for('add_comment', question_id=question_id, answer_id=answer[0]) }}" method="POST" enctype='multipart/form-data'>
                <label>Add comment</label>
                <input class="conditional_form_part_activator" type="checkbox" value="edit">
                <div class="conditional_form_part" id="cd">
                    <textarea class="textarea" name="get_comment"></textarea><br>
                    <input type="submit" value="Submit comment" class="cta">
                </div>
            </form>

            {% for comment in a_comments %}
                {% if comment[2] == answer[0] %}
                <div class="commentident">

                    <p class="commentzone"> {{ comment[3] }} </p>

                    <h5>
                        <a href="{{ url_for('remove_comment', question_id=question_id, comment_id=comment[0]) }}" class="delete_mini">✖ Delete</a> Submission Time: {{ comment[4] }} | Number of times edited: {{ comment[5] }}
                    </h5>

                    <form action="{{ url_for('fetch_comment_for_edit', question_id=question_id, comment_id=comment[0]) }}" method="POST" enctype='multipart/form-data'>
                        <label>Edit comment</label>
                        <input class="conditional_form_part_activator" type="checkbox" value="edit">
                        <div class="conditional_form_part" id="cd">
                            <textarea class="textarea" name="get_comment"></textarea><br>
                            <input type="submit" value="Submit comment" class="cta">
                        </div>
                    </form>

                </div>
                {% endif %}
            {% endfor %}

        {% endfor %}

    {% endif %}
    
</div>
{% endblock %}
